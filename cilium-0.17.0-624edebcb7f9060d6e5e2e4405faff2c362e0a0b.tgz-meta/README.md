[![CircleCI](https://circleci.com/gh/giantswarm/cilium-app.svg?style=shield)](https://circleci.com/gh/giantswarm/cilium-app)

# cilium chart

Giant Swarm offers a cilium App which can be installed in workload clusters.

## Installing

There are several ways to install this app onto a workload cluster.

- [Using our web interface](https://docs.giantswarm.io/ui-api/web/app-platform/#installing-an-app).
- By creating an [App resource](https://docs.giantswarm.io/ui-api/management-api/crd/apps.application.giantswarm.io/) in the management cluster as explained in [Getting started with App Platform](https://docs.giantswarm.io/app-platform/getting-started/).

## Upgrading cilium version

The contents of the `helm` folder are being generated by the `make` target called `make update-chart`.

This target uses [`vendir`](https://carvel.dev/vendir/) to fetch the helm chart contained in [the fork of the cilium repository that we maintain](https://github.com/giantswarm/cilium-upstream).
Currently, the main branch on the fork contains upstream branch `v1.13`, with our custom changes on top.
If you want to upgrade this cilium-app to use a newer version of cilium, you need to prepare our fork first.
We need to create a new branch on our fork based off the branch of the version we want to upgrade to. For example, if we want to upgrade to cilium v1.14, we need to create a new branch based off the upstream `v1.14` branch.
Then we need to apply our custom changes on top of that new branch. You can use `cherry-pick` for that, for example
```
git cherry-pick a4b22dee87ba3663f967f6dd6d8e666c849c742d^..25c449534cc325a5798fc7c839b8ac33591b3516
```

Then, we need to update the `vendir` configuration in `vendir.yml` on this repository to use the new branch, and run the make target `APPLICATION=cilium make update-chart`.
With the generated changes, let's create a new pull request so that everyone can review the changes that will be applied to the cilium chart.
If we need further customizations, we can keep adding commits on the new branch, and re-run `make update-chart` to update the generated files.

Once we are happy with the changes, we can merge the changes in the fork to the fork's `main` branch. After merging, the `main` branch in our fork should contain cilium `v1.14` with our customizations on top.
Then update our pull request to use the fork's `main` branch again, and merge it.
Finally, we just need to create a new release of this cilium-app.
